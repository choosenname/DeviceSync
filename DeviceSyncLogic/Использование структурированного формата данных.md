Третий вариант предполагает использование структурированного формата данных для передачи информации о типе данных и самих данных. Рассмотрим пример с использованием JSON.

1. Создайте классы для разных типов сообщений:

```csharp
public class TextMessage
{
    public string Type { get; set; } = "Text";
    public string Content { get; set; }
}

public class FileMessage
{
    public string Type { get; set; } = "File";
    public byte[] Content { get; set; }
    public string FileName { get; set; }
}
```

2. При отправке данных, сериализуйте объекты в JSON:

```csharp
TextMessage textMessage = new TextMessage { Content = "Hello, World!" };
string jsonTextMessage = JsonConvert.SerializeObject(textMessage);
byte[] dataToSend = Encoding.UTF8.GetBytes(jsonTextMessage);
```

3. При получении данных, десериализуйте JSON и обработайте сообщение в зависимости от его типа:

```csharp
byte[] receivedData = ... // Полученные данные
string receivedJson = Encoding.UTF8.GetString(receivedData);
JObject receivedObject = JObject.Parse(receivedJson);
string messageType = receivedObject["Type"].ToString();

if (messageType == "Text")
{
    TextMessage textMessage = receivedObject.ToObject<TextMessage>();
    // Обработка текстового сообщения
}
else if (messageType == "File")
{
    FileMessage fileMessage = receivedObject.ToObject<FileMessage>();
    // Обработка файла
}
```

Таким образом, вы можете передавать и обрабатывать разные типы сообщений, используя структурированный формат данных, в данном случае JSON.